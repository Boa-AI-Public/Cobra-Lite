<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cobra Lite | Security Testing Interface</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500;600&family=Space+Grotesk:wght@400;500;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}" />
  </head>
  <body>
    <div class="grid-bg" aria-hidden="true"></div>
    <header class="topbar">
      <div class="brand">
        <div class="brand-logo-shell">
          <img
            class="brand-logo"
            src="{{ url_for('static', filename='images/boa-logo-bw.svg') }}"
            alt="Cobra Lite logo"
          />
        </div>
        <div class="brand-copy">
          <span class="brand-mark">Cobra Lite</span>
          <span class="brand-sub">Security Testing Interface</span>
        </div>
      </div>
      <div class="top-actions">
        <button id="settings-btn" class="icon-btn" type="button" aria-label="Settings">
          &#9881;
        </button>
      </div>
    </header>

    <main class="shell">
      <div class="workspace">
        <aside id="session-pane" class="session-pane {% if not has_gateway %}hidden{% endif %}">
          <div class="session-pane-head">
            <div class="session-pane-head-row">
              <h2>Sessions</h2>
              <button
                id="session-fold-btn"
                class="session-fold-btn"
                type="button"
                aria-expanded="true"
                aria-controls="session-list"
                title="Collapse sessions"
              >
                Â«
              </button>
            </div>
            <button id="new-session-btn" class="ghost-btn new-session-btn" type="button">+ New Session</button>
          </div>
          <div id="session-list" class="session-list" aria-live="polite"></div>
          <p id="session-status" class="status-text" aria-live="polite"></p>
        </aside>

        <div class="chat-column">
          <section id="key-gate" class="panel token-panel {% if has_gateway %}hidden{% endif %}">
            <h2>Connect to Gateway</h2>
            <p class="panel-sub">
              Enter your gateway URL. The default is <code>{{ default_gateway_url }}</code> for local instances.
              <span class="help-wrap">
                <button type="button" class="help-icon" aria-label="What is this?">?</button>
                <span class="help-popup">
                  Gateway is the local service that powers automation, tools, and session orchestration for this UI.
                  <a href="https://docs.openclaw.ai" target="_blank" rel="noopener noreferrer">
                    Documentation
                  </a>
                </span>
              </span>
            </p>
            <form id="key-form" class="stack-form" autocomplete="off">
              <label for="api-key-input" class="sr-only">Gateway URL</label>
              <input
                id="api-key-input"
                name="gateway_url"
                type="text"
                placeholder="{{ default_gateway_url }}"
                value="{{ saved_gateway_url }}"
                required
              />
              <button class="cta-btn" type="submit">Connect</button>
            </form>
            <p id="key-status" class="status-text" aria-live="polite"></p>
          </section>

          <section id="main-app" class="panel prompt-panel {% if not has_gateway %}hidden{% endif %}">
            <div class="prompt-header">
              <h2>Chat</h2>
              <p>User messages and final AI answers appear here.</p>
            </div>
            <div id="chat-thread" class="chat-thread" aria-live="polite"></div>
          </section>

          <section id="composer-dock" class="composer-dock {% if not has_gateway %}hidden{% endif %}">
            <form id="prompt-form" class="prompt-form">
              <label for="prompt-input" class="sr-only">Prompt</label>
              <div class="prompt-composer">
                <textarea
                  id="prompt-input"
                  name="prompt"
                  rows="1"
                  placeholder="Describe your security testing task..."
                  required
                ></textarea>
                <button class="cta-btn prompt-submit" type="submit">Send</button>
              </div>
            </form>
            <p id="prompt-status" class="status-text" aria-live="polite"></p>
          </section>
        </div>
        <div
          id="chat-execution-resizer"
          class="pane-resizer pane-resizer-horizontal {% if not has_gateway %}hidden{% endif %}"
          role="separator"
          aria-orientation="vertical"
          aria-label="Resize chat and execution panes"
          tabindex="0"
        ></div>

        <aside id="execution-pane" class="panel execution-pane {% if not has_gateway %}hidden{% endif %}">
          <div class="execution-header">
            <h2>Execution</h2>
            <div class="execution-tabs" role="tablist" aria-label="Execution view">
              <button
                id="execution-tab-terminal"
                class="execution-tab active"
                type="button"
                role="tab"
                aria-selected="true"
                aria-controls="execution-terminal-view"
              >
                Terminal
              </button>
              <button
                id="execution-tab-graph"
                class="execution-tab"
                type="button"
                role="tab"
                aria-selected="false"
                aria-controls="execution-graph-view"
              >
                Graph
              </button>
              <button
                id="execution-tab-files"
                class="execution-tab"
                type="button"
                role="tab"
                aria-selected="false"
                aria-controls="execution-files-view"
              >
                Files
              </button>
            </div>
          </div>
          <section id="execution-terminal-view" class="execution-view" role="tabpanel" aria-labelledby="execution-tab-terminal">
            <div id="execution-feed" class="execution-feed" aria-live="polite">
              <div class="execution-empty">Run a prompt to stream terminal output.</div>
            </div>
          </section>
          <section
            id="execution-graph-view"
            class="execution-view hidden"
            role="tabpanel"
            aria-labelledby="execution-tab-graph"
          >
            <div class="graph-placeholder">Graph view is empty for now.</div>
          </section>
          <section
            id="execution-files-view"
            class="execution-view hidden"
            role="tabpanel"
            aria-labelledby="execution-tab-files"
          >
            <div class="files-view">
              <div class="files-selector">
                <div class="files-toolbar">
                  <button id="files-up-btn" class="ghost-btn files-action-btn" type="button">Up</button>
                  <button id="files-refresh-btn" class="ghost-btn files-action-btn" type="button">Refresh</button>
                </div>
                <div id="files-breadcrumb" class="files-breadcrumb">Workspace</div>
                <div id="files-list" class="files-list" aria-live="polite"></div>
              </div>
              <div
                id="files-resizer"
                class="pane-resizer pane-resizer-vertical"
                role="separator"
                aria-orientation="horizontal"
                aria-label="Resize file explorer and preview"
                tabindex="0"
              ></div>
              <div class="files-reader">
                <div id="files-preview-meta" class="files-preview-meta">Select a file to preview.</div>
                <textarea
                  id="files-preview-content"
                  class="files-preview-content"
                  readonly
                  spellcheck="false"
                ></textarea>
              </div>
            </div>
          </section>
        </aside>
      </div>

      <p class="tool-attribution">Cobra Lite</p>
    </main>

    <div id="settings-modal" class="modal hidden" role="dialog" aria-modal="true" aria-labelledby="settings-title">
      <div class="modal-card">
        <div class="modal-head">
          <h3 id="settings-title">Update Gateway URL</h3>
          <button id="close-settings" class="icon-btn" type="button" aria-label="Close settings">&times;</button>
        </div>
        <form id="settings-form" class="stack-form" autocomplete="off">
          <label for="settings-key-input" class="sr-only">New Gateway URL</label>
          <input
            id="settings-key-input"
            name="gateway_url"
            type="text"
            placeholder="{{ default_gateway_url }}"
            required
          />
          <button class="cta-btn" type="submit">Save URL</button>
        </form>
        <p id="settings-status" class="status-text" aria-live="polite"></p>
      </div>
    </div>

    <div
      id="auth-modal"
      class="modal hidden"
      role="dialog"
      aria-modal="true"
      aria-labelledby="auth-title"
      aria-describedby="auth-description"
    >
      <div class="modal-card">
        <div class="modal-head">
          <h3 id="auth-title">Add Anthropic API Key</h3>
        </div>
        <p id="auth-description" class="panel-sub">
          Cobra Lite needs an Anthropic API key to run prompts with your local OpenClaw agent.
        </p>
        <form id="auth-form" class="stack-form" autocomplete="off">
          <label for="auth-key-input" class="sr-only">Anthropic API key</label>
          <input
            id="auth-key-input"
            name="anthropic_api_key"
            type="password"
            placeholder="sk-ant-..."
            required
          />
          <button class="cta-btn" type="submit">Save Key</button>
        </form>
        <p id="auth-status" class="status-text" aria-live="polite"></p>
      </div>
    </div>

    <script>
      window.CLAW_HAS_GATEWAY = {{ "true" if has_gateway else "false" }};
      window.CLAW_HAS_ANTHROPIC_KEY = {{ "true" if has_anthropic_key else "false" }};
      window.CLAW_DEFAULT_GATEWAY_URL = {{ default_gateway_url | tojson }};
    </script>
    <script src="{{ url_for('static', filename='app.js') }}"></script>
  </body>
</html>
